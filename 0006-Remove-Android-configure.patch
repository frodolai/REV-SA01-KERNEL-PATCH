From d14af13ac0ef42f9fa84bbad37dfaeabd0979ef8 Mon Sep 17 00:00:00 2001
From: Bingru Tsai <ben_tsai@avalue.com.tw>
Date: Mon, 26 Jan 2015 16:50:17 +0800
Subject: [PATCH 06/17] Remove Android configure.

---
 kernel/arch/arm/mach-mx6/smarc/rev_sa01.c | 121 ------------------------------
 1 file changed, 121 deletions(-)

diff --git a/kernel/arch/arm/mach-mx6/smarc/rev_sa01.c b/kernel/arch/arm/mach-mx6/smarc/rev_sa01.c
index 1fb6271..6458491 100644
--- a/kernel/arch/arm/mach-mx6/smarc/rev_sa01.c
+++ b/kernel/arch/arm/mach-mx6/smarc/rev_sa01.c
@@ -1,11 +1,6 @@
 #include <asm/setup.h>
 #include <mach/common.h>
 #include <linux/memblock.h>
-
-#ifdef	CONFIG_ION
-#include <linux/ion.h>
-#endif
-
 #include <linux/clk.h>
 #include <linux/regulator/anatop-regulator.h>
 #include <linux/regulator/consumer.h>
@@ -304,21 +299,6 @@ static struct imx_ipuv3_platform_data ipu_data[] = {
 	},
 };
 
-#ifdef  CONFIG_ION
-static struct ion_platform_data imx_ion_data = {
-	.nr = 1,
-	.heaps = {
-	{
-		.id = 0,
-		.type = ION_HEAP_TYPE_CARVEOUT,
-		.name = "vpu_ion",
-		.size = SZ_16M,
-		.cacheable = 1,
-	},
-	},
-};
-#endif
-
 void smarc_fb_init(void)
 {
 	int i = 0;
@@ -501,7 +481,6 @@ void __init smarc_board_init(void)
 	mx6q_init_audio();
 	smarc_fb_init();
 	set_smarc_lvds();
-	//#error
 	imx6q_add_lcdif(&lcdif_data);
 	//imx6q_add_ldb(&ldb_data);
 	set_smarc_hdmi();
@@ -522,113 +501,13 @@ void __init smarc_board_init(void)
 	} else {
 		mxc_iomux_v3_setup_multiple_pads(mx6solo_smarc_other_pads, ARRAY_SIZE(mx6solo_smarc_other_pads));
 	}
-
-	#ifdef  CONFIG_ION
-	if (imx_ion_data.heaps[0].size) {
-		imx6q_add_ion(0, &imx_ion_data, sizeof(imx_ion_data) + sizeof(struct ion_platform_heap));
-	}
-	#endif
 }
 
 void fixup_board(struct machine_desc *desc, struct tag *tags, char **cmdline, struct meminfo *mi)
 {
-	char *str = NULL;
-	struct tag *t = NULL;
-	int i = 0;
-	struct ipuv3_fb_platform_data *pdata_fb = smarc_fb_data;
-
-	for_each_tag(t, tags) {
-		if (t->hdr.tag == ATAG_CMDLINE) {
-			str = t->u.cmdline.cmdline;
-			str = strstr(str, "fbmem=");
-			if (str != NULL) {
-				str += 6;
-				pdata_fb[i++].res_size[0] = memparse(str, &str);
-				while (*str == ',' && i < ARRAY_SIZE(smarc_fb_data)) {
-					str++;
-					pdata_fb[i++].res_size[0] = memparse(str, &str);
-				}
-			}
-
-			#ifdef  CONFIG_ION
-			/* ION reserved memory */
-			str = t->u.cmdline.cmdline;
-			str = strstr(str, "ionmem=");
-			if (str != NULL) {
-				str += 7;
-				imx_ion_data.heaps[0].size = memparse(str, &str);
-			}
-			#endif
-
-			/* Primary framebuffer base address */
-			str = t->u.cmdline.cmdline;
-			str = strstr(str, "fb0base=");
-			if (str != NULL) {
-				str += 8;
-				pdata_fb[0].res_base[0] = simple_strtol(str, &str, 16);
-			}
-
-			/* GPU reserved memory */
-			str = t->u.cmdline.cmdline;
-			str = strstr(str, "gpumem=");
-			if (str != NULL) {
-				str += 7;
-				imx6q_gpu_pdata.reserved_mem_size = memparse(str, &str);
-			}
-			break;
-		}
-	}
 }
 
 void reserve(void)
 {
-	phys_addr_t phys;
-	int i, fb0_reserved = 0, fb_array_size;
-
-	/*
-	 * Reserve primary framebuffer memory if its base address
-	 * is set by kernel command line.
-	 */
-	fb_array_size = ARRAY_SIZE(smarc_fb_data);
-	if (fb_array_size > 0 && smarc_fb_data[0].res_base[0] && smarc_fb_data[0].res_size[0]) {
-		memblock_reserve(smarc_fb_data[0].res_base[0], smarc_fb_data[0].res_size[0]);
-		memblock_remove(smarc_fb_data[0].res_base[0], smarc_fb_data[0].res_size[0]);
-		smarc_fb_data[0].late_init = true;
-		ipu_data[ldb_data.ipu_id].bypass_reset = true;
-		fb0_reserved = 1;
-	}
-
-	for (i = fb0_reserved; i < fb_array_size; i++) {
-		if (smarc_fb_data[i].res_size[0]) {
-			/* Reserve for other background buffer. */
-			phys = memblock_alloc(smarc_fb_data[i].res_size[0], SZ_4K);
-			memblock_remove(phys, smarc_fb_data[i].res_size[0]);
-			smarc_fb_data[i].res_base[0] = phys;
-		}
-	}
-
-	#ifdef CONFIG_ANDROID_RAM_CONSOLE
-	phys = memblock_alloc_base(SZ_128K, SZ_4K, SZ_1G);
-	memblock_remove(phys, SZ_128K);
-	memblock_free(phys, SZ_128K);
-	ram_console_resource.start = phys;
-	ram_console_resource.end   = phys + SZ_128K - 1;
-	#endif
-
-	#if defined(CONFIG_MXC_GPU_VIV) || defined(CONFIG_MXC_GPU_VIV_MODULE)
-	if (imx6q_gpu_pdata.reserved_mem_size) {
-		phys = memblock_alloc_base(imx6q_gpu_pdata.reserved_mem_size, SZ_4K, SZ_1G);
-		memblock_remove(phys, imx6q_gpu_pdata.reserved_mem_size);
-		imx6q_gpu_pdata.reserved_mem_base = phys;
-	}
-	#endif
-
-	#if defined(CONFIG_ION)
-	if (imx_ion_data.heaps[0].size) {
-		phys = memblock_alloc(imx_ion_data.heaps[0].size, SZ_4K);
-		memblock_remove(phys, imx_ion_data.heaps[0].size);
-		imx_ion_data.heaps[0].base = phys;
-	}
-	#endif
 }
 
-- 
1.9.1

